<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script
      src="https://code.jquery.com/jquery-3.7.1.min.js"
      integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
      crossorigin="anonymous"
    ></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"
    ></script>
    <title>signup (회원가입 페이지)</title>
  </head>
  <link rel="stylesheet" href="../static/css/signup.css">

  <body>
    <nav class="navbar bg-body-tertiary fixed-top">
        <div class="container-fluid">
          <!-- 공유하기 버튼 이미지 만들어서 수정 -->
          <a class="navbar-brand" href="#">공유하기</a>
          <div class="navbar-brand" id="zara">자라나라 새싹나라</div>
          <button
            class="navbar-toggler"
            type="button"
            data-bs-toggle="offcanvas"
            data-bs-target="#offcanvasNavbar"
            aria-controls="offcanvasNavbar"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
          <div
            class="offcanvas offcanvas-end"
            tabindex="-1"
            id="offcanvasNavbar"
            aria-labelledby="offcanvasNavbarLabel"
          >
            <div class="offcanvas-header">
             
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="offcanvas"
                aria-label="Close"
              ></button>
            </div>
            <div class="offcanvas-body">
              <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
                <li class="nav-item">
                  <a class="nav-link" aria-current="page" href="/home"
                    >홈으로 가기</a
                  >
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="/home/signin">로그인</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="#">산책하기</a>
                </li>
        </div>
      </nav>
      <div class="sky"></div>
    <div class="signup-border"></div>
    <form class="signup" name="user_upload">
        <div class="title-border"><h3 class="title">회원가입</h3></div>
        <div class="realForm">
      <div class="btn-id"><input type="text" name="user_id" class="id-form" placeholder="아이디"/>
        <button type="button" onclick="userIdCheck()">중복 확인</button>
      </div>
      <div><input type="text" name="user_name" class="nk-form" placeholder="닉네임"/></div>
      <div><input type="password" name="user_pw" class="pw-form"placeholder="비밀번호"/></div>
      <div><input type="password" name="user_pw_check" class="pwCheck-form" placeholder="비밀번호 확인"/>
        <!-- <button type="button" onclick="pwCheck()">비밀번호 확인</button> -->
      </div>
      <div><input type="text" name="user_mbti" class="mb-form" placeholder="MBTI"/></div>
      <label for="file"><div class="btn-upload">프로필 이미지 업로드</div></label><input type="file" name="user_img" id="file"/>
      <div><input type="textarea" name="user_intro_self" class="self-form" placeholder="자기소개"/></div>
      <div>
        <button type="button" onclick="userSignUp()" class="btn-signup">가입하기</button>
      </div>
    </div>
    </form>

    <script>
      //회원가입 버튼 클릭 시 user 데이터를 db로 넘김
      function userSignUp() {
        const form = document.forms['user_upload'];

        let user = {
          user_id: form.user_id.value,
          user_pw: form.user_pw.value,
          user_name: form.user_name.value,
          user_intro_self: form.user_intro_self.value,
          user_mbti: form.user_mbti.value,
          // user_img: form.user_img.files[0]  multer은 잠시 보류
        };

        axios({
          method: 'POST',
          url: '/home/signup',
          data: user,
          // headers: {
          //     "Content-type": "multipart/form-data"
          // }
        }).then((res) => {
          if (res.data.result) {
            alert('회원가입 성공 !');
          } else {
            alert('알 수 없는 오류가 발생했습니다.');
          }
        });
      }

      // 아이디 중복 확인 버튼 클릭 시
      function userIdCheck() {
        const form = document.forms['user_upload'];

        axios({
          method: 'POST',
          url: '/home/signup/idCheck',
          data: {
            user_id: form.user_id.value,
          },
        }).then((res) => {
          // true 값이 들어오면 아이디가 존재하지 않는다는 뜻
          console.log('idCheck res :', res);
          if (res.data.result) {
            alert('사용 가능한 아이디입니다.'); // 회원가입 버튼 활성화
          } else alert('중복된 아이디입니다.'); // 중복된 아이디일 경우 회원가입 버튼이 활성화 되지 않음 = 회원가입 버튼은 default 값 = false(비활성화)
        });
      }

      // 비밀번호 일치 확인 버튼 클릭 시
      // 일단은 버튼으로 만들었으나 후에는 작성시 바로 메시지형식? 으로 뜨면 좋을 것 같음
      function pwCheck() {
        const form = document.forms['user_upload'];

        let pwData = {
          user_pw: form.user_pw.value,
          user_pw_check: form.user_pw_check.value,
        };

        if (pwData.user_pw == pwData.user_pw_check) {
          alert('일치');
        } else {
          alert('불일치');
        }
      }
    </script>
  </body>
</html>
